<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-05-14">

<title>Quantitative Peer Learning Community R Training - Data Cleaning and Processing in R: Part 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href=".smaller h1 {
  font-size: 0.5em; /* Adjust the font size as needed */
}">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Data Cleaning and Processing in R: Part 1</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../images/primary_one-color_reverse.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Setup</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../class_materials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Class Materials</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R Resources</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#agenda" id="toc-agenda" class="nav-link active" data-scroll-target="#agenda">Agenda</a></li>
  <li><a href="#homework-review" id="toc-homework-review" class="nav-link" data-scroll-target="#homework-review">Homework Review</a>
  <ul class="collapse">
  <li><a href="#homework-review-format-scatter-plots" id="toc-homework-review-format-scatter-plots" class="nav-link" data-scroll-target="#homework-review-format-scatter-plots">Homework Review: Format Scatter Plots</a></li>
  <li><a href="#homework-review-format-scatter-plots-1" id="toc-homework-review-format-scatter-plots-1" class="nav-link" data-scroll-target="#homework-review-format-scatter-plots-1">Homework Review: Format Scatter Plots</a></li>
  <li><a href="#homework-review-packages-and-pipe-operator" id="toc-homework-review-packages-and-pipe-operator" class="nav-link" data-scroll-target="#homework-review-packages-and-pipe-operator">Homework Review: Packages and Pipe Operator</a></li>
  </ul></li>
  <li><a href="#principles-of-tidy-data" id="toc-principles-of-tidy-data" class="nav-link" data-scroll-target="#principles-of-tidy-data">Principles of tidy data</a>
  <ul class="collapse">
  <li><a href="#cleaning-your-data-one-of-the-most-important-and-under-appreciated-stages-of-good-data-analysis" id="toc-cleaning-your-data-one-of-the-most-important-and-under-appreciated-stages-of-good-data-analysis" class="nav-link" data-scroll-target="#cleaning-your-data-one-of-the-most-important-and-under-appreciated-stages-of-good-data-analysis">Cleaning your data: One of the most important and under-appreciated stages of good data analysis</a></li>
  <li><a href="#the-principles-of-tidy-data-provide-a-helpful-vision-of-what-good-clean-data-should-look-like" id="toc-the-principles-of-tidy-data-provide-a-helpful-vision-of-what-good-clean-data-should-look-like" class="nav-link" data-scroll-target="#the-principles-of-tidy-data-provide-a-helpful-vision-of-what-good-clean-data-should-look-like">The principles of “tidy data” provide a helpful vision of what good, clean data should look like</a></li>
  <li><a href="#building-tidy-data-sets-will-bring-consistency-to-your-data-across-scriptsprojects" id="toc-building-tidy-data-sets-will-bring-consistency-to-your-data-across-scriptsprojects" class="nav-link" data-scroll-target="#building-tidy-data-sets-will-bring-consistency-to-your-data-across-scriptsprojects">Building tidy data sets will bring consistency to your data across scripts/projects</a></li>
  <li><a href="#it-takes-some-work-to-make-data-tidy-including-the-use-of-functions-to-reshape-your-data" id="toc-it-takes-some-work-to-make-data-tidy-including-the-use-of-functions-to-reshape-your-data" class="nav-link" data-scroll-target="#it-takes-some-work-to-make-data-tidy-including-the-use-of-functions-to-reshape-your-data">It takes some work to make data tidy, including the use of functions to reshape your data</a></li>
  <li><a href="#live-coding-example-using-pivot_longer-function" id="toc-live-coding-example-using-pivot_longer-function" class="nav-link" data-scroll-target="#live-coding-example-using-pivot_longer-function">Live coding example: Using <code>pivot_longer()</code> function</a></li>
  <li><a href="#it-takes-a-bit-of-work-to-make-data-tidy-including-the-use-of-functions-to-reshape-your-data-cont." id="toc-it-takes-a-bit-of-work-to-make-data-tidy-including-the-use-of-functions-to-reshape-your-data-cont." class="nav-link" data-scroll-target="#it-takes-a-bit-of-work-to-make-data-tidy-including-the-use-of-functions-to-reshape-your-data-cont.">It takes a bit of work to make data tidy, including the use of functions to reshape your data, cont.</a></li>
  <li><a href="#live-coding-example-using-pivot_wider-function" id="toc-live-coding-example-using-pivot_wider-function" class="nav-link" data-scroll-target="#live-coding-example-using-pivot_wider-function">Live coding example: Using <code>pivot_wider()</code> function</a></li>
  </ul></li>
  <li><a href="#techniques-to-clean-messy-data" id="toc-techniques-to-clean-messy-data" class="nav-link" data-scroll-target="#techniques-to-clean-messy-data">Techniques to clean messy data</a>
  <ul class="collapse">
  <li><a href="#cleaning-data-can-be-challenging-but-its-easier-if-you-take-a-systematic-approach-to-every-raw-data-file" id="toc-cleaning-data-can-be-challenging-but-its-easier-if-you-take-a-systematic-approach-to-every-raw-data-file" class="nav-link" data-scroll-target="#cleaning-data-can-be-challenging-but-its-easier-if-you-take-a-systematic-approach-to-every-raw-data-file">Cleaning data can be challenging, but it’s easier if you take a systematic approach to every raw data file</a></li>
  <li><a href="#in-class-coding-example-minnesota-graduation-data" id="toc-in-class-coding-example-minnesota-graduation-data" class="nav-link" data-scroll-target="#in-class-coding-example-minnesota-graduation-data">In-class coding example: Minnesota graduation data</a></li>
  <li><a href="#your-data-will-rarely-come-in-a-single-table-so-you-will-need-to-use-join-functions-to-merge-the-data-frames" id="toc-your-data-will-rarely-come-in-a-single-table-so-you-will-need-to-use-join-functions-to-merge-the-data-frames" class="nav-link" data-scroll-target="#your-data-will-rarely-come-in-a-single-table-so-you-will-need-to-use-join-functions-to-merge-the-data-frames">Your data will rarely come in a single table, so you will need to use join functions to merge the data frames</a></li>
  <li><a href="#using-left_join-to-merge-data-sets-will-help-preserve-your-data" id="toc-using-left_join-to-merge-data-sets-will-help-preserve-your-data" class="nav-link" data-scroll-target="#using-left_join-to-merge-data-sets-will-help-preserve-your-data">Using <code>left_join()</code> to merge data sets will help preserve your data</a></li>
  <li><a href="#coding-example-how-to-use-left_join" id="toc-coding-example-how-to-use-left_join" class="nav-link" data-scroll-target="#coding-example-how-to-use-left_join">Coding example: How to use left_join()</a></li>
  </ul></li>
  <li><a href="#homework-assignment" id="toc-homework-assignment" class="nav-link" data-scroll-target="#homework-assignment">Homework assignment</a>
  <ul class="collapse">
  <li><a href="#this-weeks-assignment" id="toc-this-weeks-assignment" class="nav-link" data-scroll-target="#this-weeks-assignment">This week’s assignment</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="class_4.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data Cleaning and Processing in R: Part 1</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 14, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(countdown)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(edbuildr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>bw_primary <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#6D1E4A"</span>, <span class="co"># 1 plum</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>                <span class="st">"#007786"</span>, <span class="co"># 2 teal</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>                <span class="st">"#0D525A"</span>, <span class="co"># 3 dark green</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>                <span class="st">"#212B46"</span>, <span class="co"># 4 navy</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>                <span class="st">"#5A6675"</span>, <span class="co"># 5 grey</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>                <span class="st">"#F0DEC1"</span>) <span class="co"># 6 cream</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>bw_secondary <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#FFC762"</span>, <span class="co"># 1 yellow</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"#FFB653"</span>, <span class="co"># 2 orange</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"#BEC6CE"</span>, <span class="co"># 3 light grey</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"#2E1A4A"</span>, <span class="co"># 4 deep purple</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"#7EA2D1"</span>, <span class="co"># 5 soft blue</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"#CAD3FB"</span>, <span class="co"># 6 lavender</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"#9CD4EA"</span>, <span class="co"># 7 sky</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"#FFA497"</span>) <span class="co"># 8 peach</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="agenda" class="level2">
<h2 class="anchored" data-anchor-id="agenda">Agenda</h2>
<ul>
<li>Homework review</li>
<li>Principles of tidy data</li>
<li>Techniques to clean messy data</li>
<li>Joining data sets</li>
<li>Homework and next class</li>
</ul>
</section>
<section id="homework-review" class="level1">
<h1>Homework Review</h1>
<section id="homework-review-format-scatter-plots" class="level2">
<h2 class="anchored" data-anchor-id="homework-review-format-scatter-plots">Homework Review: Format Scatter Plots</h2>
<p>For those who turned in homework, you all did a great job with creating clean data frames and everyone made scatter plots. We were mixed on formatting scatter plots. The code below includes all the key elements of a beautified scatter plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(vt_ed_data, <span class="fu">aes</span> (<span class="at">x =</span> mpv, <span class="at">y =</span> local_rev_pp, <span class="at">size =</span> enroll, <span class="at">color =</span> stpovrate)) <span class="sc">+</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>()) <span class="sc">+</span> <span class="co"># This line indicates that the color label is a percent </span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span> (<span class="at">labels =</span> <span class="fu">label_dollar</span>()) <span class="sc">+</span> <span class="co"># This line labels the x-axis with dollar signs </span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span> (<span class="at">labels =</span> <span class="fu">label_dollar</span>()) <span class="sc">+</span> <span class="co"># This line labels the y-axis with dollar signs </span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_area</span>(<span class="at">labels =</span> <span class="fu">label_comma</span>(), <span class="at">max_size =</span> <span class="dv">10</span>) <span class="sc">+</span> <span class="co"># This indicates that the size label should have a comma</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Median Property Value"</span>, <span class="at">y =</span> <span class="st">"Local Per-Pupil Revenue"</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Vermont Local Per-Pupil Revenue by Property Value"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: Edbuild Data, 2019"</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">size =</span> <span class="st">"Enrollment"</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Poverty Rate"</span>) <span class="sc">+</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="homework-review-format-scatter-plots-1" class="level2">
<h2 class="anchored" data-anchor-id="homework-review-format-scatter-plots-1">Homework Review: Format Scatter Plots</h2>
<p>The final scatter plot has formatted labels, legend, and title.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Rplot.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="homework-review-packages-and-pipe-operator" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="homework-review-packages-and-pipe-operator">Homework Review: Packages and Pipe Operator</h2>
<p>R won’t do something unless you tell it to do it. With that in mind, a few of general reminders:</p>
<ul>
<li>Load your packages at the top of your script</li>
<li>Use the pipe operator (|&gt;) to chain the functions together</li>
<li>A function will not work by itself. You need to tell R which current data frame it will manipulate to create the new data frame</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load -----</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(edbuildr)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># clean the data ------</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>vt_ed_data <span class="ot">&lt;-</span> vt_ed_data <span class="sc">|&gt;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">state =</span> State,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">district_id =</span> state_id,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">enroll =</span> ENROLL,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">sr =</span> SR,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">lr =</span> LR,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">srpp_cola =</span> SRPP_cola,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">lrpp_cola =</span> LRPP_cola,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">total_enroll =</span> dEnroll_district,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">sped_count =</span> dIEP,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">mpv =</span> MPV,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">mhi =</span> MHI,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">stpovrate =</span> StPovRate) <span class="sc">|&gt;</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state_rev_pp =</span> sr<span class="sc">/</span>enroll,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">local_rev_pp =</span> lr<span class="sc">/</span>enroll,</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">local_rev_pp_diff =</span> lrpp_cola <span class="sc">-</span> local_rev_pp,</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">state_rev_pp_diff =</span> srpp_cola <span class="sc">-</span> state_rev_pp,</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">sped_pct =</span> sped_count<span class="sc">/</span>enroll) <span class="sc">|&gt;</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(enroll <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, district_id, enroll, state_rev_pp, local_rev_pp, srpp_cola, lrpp_cola,</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>         local_rev_pp_diff, state_rev_pp_diff, sped_pct, mpv, mhi, stpovrate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="principles-of-tidy-data" class="level1">
<h1>Principles of tidy data</h1>
<section id="cleaning-your-data-one-of-the-most-important-and-under-appreciated-stages-of-good-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="cleaning-your-data-one-of-the-most-important-and-under-appreciated-stages-of-good-data-analysis">Cleaning your data: One of the most important and under-appreciated stages of good data analysis</h2>
<ul>
<li><p>Most data rarely come to us in a format that is plug-and-play ready for analysis.</p></li>
<li><p>High-quality data analysis must start with gathering and cleaning relevant data.</p></li>
<li><p>This starts with ensuring that each data frame of raw data you read into R goes through a process of becoming “tidy” — once you have tidy data, merging and visualizing data becomes much easier.</p></li>
<li><p>The process of tidying your data is also helpful for identifying anomalies or outliers in your raw data files.</p></li>
</ul>
<blockquote class="blockquote">
<p><strong>“Tidy data sets are all alike, but every messy data set is messy in its own way.”</strong> - Hadley Wickham</p>
</blockquote>
</section>
<section id="the-principles-of-tidy-data-provide-a-helpful-vision-of-what-good-clean-data-should-look-like" class="level2">
<h2 class="anchored" data-anchor-id="the-principles-of-tidy-data-provide-a-helpful-vision-of-what-good-clean-data-should-look-like">The principles of “tidy data” provide a helpful vision of what good, clean data should look like</h2>
<p>Tidy data follows three rules:</p>
<ol type="1">
<li>Each column is a variable</li>
<li>Each row is an observation</li>
<li>Each cell is a value</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://d33wubrfki0l68.cloudfront.net/6f1ddb544fc5c69a2478e444ab8112fb0eea23f8/08547/images/r4ds/tidy-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="3520"></p>
<figcaption>Source: R for Data Science</figcaption>
</figure>
</div>
</section>
<section id="building-tidy-data-sets-will-bring-consistency-to-your-data-across-scriptsprojects" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="building-tidy-data-sets-will-bring-consistency-to-your-data-across-scriptsprojects">Building tidy data sets will bring consistency to your data across scripts/projects</h2>
<p>Tidy data sets also make it easier to work with functions in the <code>tidyverse</code>, which is built to work will with “tidy” data. The package we will focus on today is the <code>tidyr</code> package, which is designed to help you tidy up your messy data into a structured, organized format that is conducive to analysis and visualization. It offers a suite of functions for reshaping and transforming your data, making it easier to work with in downstream analyses.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://bookdown.org/michela_cameletti/rcodingfordatascience/images/4_tidyverse-packages.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="it-takes-some-work-to-make-data-tidy-including-the-use-of-functions-to-reshape-your-data" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="it-takes-some-work-to-make-data-tidy-including-the-use-of-functions-to-reshape-your-data">It takes some work to make data tidy, including the use of functions to reshape your data</h2>
<p>Data sets can violate the principles of tidy data in several ways. The most common way is for a variable to be embedded across columns. For example, multiple columns can represent data from different years. In this case, a variable (year) is actually represented by column names instead of being captured in its own “year” column.</p>
<p><strong>Solution:</strong> If your data includes a variable that is embedded across several column names, use the <strong>pivot_longer()</strong> function</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://epirhandbook.com/en/images/pivoting/pivot_longer_new.png" class="img-fluid figure-img"></p>
<figcaption>Source: R for Data Science</figcaption>
</figure>
</div>
</section>
<section id="live-coding-example-using-pivot_longer-function" class="level2">
<h2 class="anchored" data-anchor-id="live-coding-example-using-pivot_longer-function">Live coding example: Using <code>pivot_longer()</code> function</h2>
<p>Key arguments of the <code>pivot_longer()</code> function:</p>
<ul>
<li><code>cols</code>: The names of the columns to pivot using tidy-select</li>
<li><code>names_to</code>: The name for the new character column</li>
<li><code>values_to</code>: The name for the new values column</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># clean the special education data -----</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>section_611_longer <span class="ot">&lt;-</span> section_611_raw <span class="sc">|&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Makes all the letters in a column lowercase</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(tolower) <span class="sc">|&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, fy2016, fy2017, fy2018, fy2019, fy2020, fy2021, fy2022) <span class="sc">|&gt;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"fy"</span>), <span class="co"># The columns start with "fy"</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"fiscal_year"</span>, <span class="co"># the names of the columns will become a value in the "fiscal_year" column</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"idea_funding"</span>) <span class="sc">|&gt;</span> <span class="co"># The values in the "fy" columns will be in the new column "idea_funding"</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use the gsub to remove the "fy" from the fiscal years so that the values are just the year</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fiscal_year =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"^fy"</span>, <span class="st">""</span>, fiscal_year))) <span class="sc">|&gt;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">idea_category =</span> <span class="st">"Part B, Grants to States"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="it-takes-a-bit-of-work-to-make-data-tidy-including-the-use-of-functions-to-reshape-your-data-cont." class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="it-takes-a-bit-of-work-to-make-data-tidy-including-the-use-of-functions-to-reshape-your-data-cont.">It takes a bit of work to make data tidy, including the use of functions to reshape your data, cont.</h2>
<p>A single observation may be spread across multiple rows: This can happen when one column includes multiple variable types within it. And example would be if a dataframe had a “data_type” column that included entries like “n_tested” and “pct_prof”.</p>
<p><strong>Solution:</strong> If your data includes data from a single observation spread across multiple rows, use the <strong>pivot_wider()</strong> function</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://bcheggeseth.github.io/112_fall_2022/images/pivot_wider.png" class="img-fluid figure-img"></p>
<figcaption>Source: R for Data Science</figcaption>
</figure>
</div>
</section>
<section id="live-coding-example-using-pivot_wider-function" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="live-coding-example-using-pivot_wider-function">Live coding example: Using <code>pivot_wider()</code> function</h2>
<p>Breaking down the code:</p>
<ul>
<li><code>names_from</code>: The column with values that include multiple variables; will be pivoted into column names.</li>
<li><code>values_from</code>: The column with values will be used as cell values after pivoting.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use pivot_wider with the 2023 graduation rate data </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>mn_graduation_fy23_wider <span class="ot">&lt;-</span> mn_graduation_fy23_raw <span class="sc">|&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Makes all the letters in a column lowercase</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(tolower) <span class="sc">|&gt;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rename the columns so there isn't a space in-between the words</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">district =</span> <span class="st">"district name"</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">dist_id =</span> <span class="st">"district number"</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">dist_type =</span> <span class="st">"district type"</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_category =</span> <span class="st">"group category"</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_group =</span> <span class="st">"student group"</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">ending_status =</span> <span class="st">"ending status"</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">four_yr_grad_pct =</span> <span class="st">"four year percent"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select the columns we want to include in our dataframe for the pivot_wider</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(district, dist_id, dist_type, group_category, student_group, ending_status, four_yr_grad_pct) <span class="sc">|&gt;</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter so that we are only looking at students who graduated in four years</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ending_status <span class="sc">==</span> <span class="st">"Graduate"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter the student demographics because we only want to look at race/ethnicity data</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(group_category <span class="sc">==</span> <span class="st">"Race/Ethnicity"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pivot_wider! </span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"student_group"</span>, <span class="co"># The names of the columns are from the student group column values</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="st">"four_yr_grad_pct"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="techniques-to-clean-messy-data" class="level1">
<h1>Techniques to clean messy data</h1>
<section id="cleaning-data-can-be-challenging-but-its-easier-if-you-take-a-systematic-approach-to-every-raw-data-file" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="cleaning-data-can-be-challenging-but-its-easier-if-you-take-a-systematic-approach-to-every-raw-data-file">Cleaning data can be challenging, but it’s easier if you take a systematic approach to every raw data file</h2>
<table class="table">
<colgroup>
<col style="width: 11%">
<col style="width: 88%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Goal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Data import</td>
<td>Ensure your import function is set up to read the data properly</td>
</tr>
<tr class="even">
<td>Column names</td>
<td><p>Reformat or manually create column names that are:</p>
<ul>
<li><p>lowercase</p></li>
<li><p>use underscores instead of spaces</p></li>
<li><p>do not begin with a number</p></li>
<li><p>follow a consistent format</p></li>
</ul></td>
</tr>
<tr class="odd">
<td>Mis-formatted data</td>
<td>Work with functions from base R like <code>as.numeric()</code> or from the <code>tidyverse</code> packages like <code>stringr</code> to clean the data that appear in a different format than you want.</td>
</tr>
<tr class="even">
<td>Missing data</td>
<td>Identify where in your dataset there are missing variables and/or outliers - this may be more of an iterative process as your explore your data.</td>
</tr>
</tbody>
</table>
</section>
<section id="in-class-coding-example-minnesota-graduation-data" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="in-class-coding-example-minnesota-graduation-data">In-class coding example: Minnesota graduation data</h2>
<p>We can manipulate the district and school data using the following functions:</p>
<ul>
<li><code>tolower()</code>: Converts characters to lowercase. It’s commonly used when dealing with character data, such as strings, to ensure uniformity in text processing and comparisons.</li>
<li><code>str_to_title()</code>: Converts strings to title case. Title case means that the first letter of each word is capitalized, while all other letters are in lowercase.</li>
<li><code>str_replace_all()</code>: Replaces all occurrences of a pattern within a string with a specified replacement.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mn_graduation_school_fy23_clean <span class="ot">&lt;-</span> mn_graduation_school_fy23_raw <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># using "tolower" to make all the values in the column lowercase</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dst_nam =</span> <span class="fu">tolower</span>(dst_nam),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">sch_nam =</span> <span class="fu">tolower</span>(sch_nam)) <span class="sc">|&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># using "str_to_title" makes the first letter of each word capitalized</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dst_nam =</span> <span class="fu">str_to_title</span>(dst_nam),</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">sch_nam =</span> <span class="fu">str_to_title</span>(sch_nam)) <span class="sc">|&gt;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># using "str_replace_all" turns "Dist" and "Dist."into "District"</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dst_nam =</span> <span class="fu">str_replace_all</span>(dst_nam, <span class="fu">c</span>(<span class="st">"Dist</span><span class="sc">\\</span><span class="st">b"</span> <span class="ot">=</span> <span class="st">"District"</span>, <span class="st">"Dist</span><span class="sc">\\</span><span class="st">."</span> <span class="ot">=</span> <span class="st">"District"</span>, <span class="st">"District</span><span class="sc">\\</span><span class="st">."</span> <span class="ot">=</span> <span class="st">"District"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="your-data-will-rarely-come-in-a-single-table-so-you-will-need-to-use-join-functions-to-merge-the-data-frames" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="your-data-will-rarely-come-in-a-single-table-so-you-will-need-to-use-join-functions-to-merge-the-data-frames">Your data will rarely come in a single table, so you will need to use join functions to merge the data frames</h2>
<p>To join two data frames, they need to share a common column with a unique identifier.</p>
<p>State departments of education typically assign a unique ID number to each school district. <strong>Make sure this is available in your data sets.</strong></p>
<p>Joining data sets on a name (e.g.&nbsp;school or district) can create problems based on:</p>
<ul>
<li>Capitalization (Mcgregor v. McGregor)</li>
<li>Abbreviation (St.&nbsp;Paul v. Saint Paul)</li>
<li>Mis-spelling (it happens!)</li>
</ul>
</section>
<section id="using-left_join-to-merge-data-sets-will-help-preserve-your-data" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="using-left_join-to-merge-data-sets-will-help-preserve-your-data">Using <code>left_join()</code> to merge data sets will help preserve your data</h2>
<ul>
<li>Once you have dataframes that share a common ID column, start with your most reliable set of data (typically student count data like ADM or enrollment) and use <code>left_join()</code> to attach additional data to that table.</li>
<li>This approach will preserve your original data, keeping the number of rows (e.g.&nbsp;districts or schools) consistent as you use <code>left_join()</code> to add data by adding more columns.</li>
<li>When a record in the “left” dataframe does not have a match in the “right” dataframe, <code>left_join()</code> will impute a value of <code>NA</code> for all such instances.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://d33wubrfki0l68.cloudfront.net/3abea0b730526c3f053a3838953c35a0ccbe8980/7f29b/diagrams/join-inner.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
<figcaption>Source: R for Data Science</figcaption>
</figure>
</div>
</section>
<section id="coding-example-how-to-use-left_join" class="level2">
<h2 class="anchored" data-anchor-id="coding-example-how-to-use-left_join">Coding example: How to use left_join()</h2>
<ul>
<li><strong>Example 1:</strong> The common ID columns have the same variable names (dist_id)</li>
<li><strong>Example 2:</strong> The common ID columns have different variable names. The il_test_data_fy23_clean dataframe’s variable is dist_id, while the example_2_il_finance_testing_fy23 dataframe’s variable name is rcdts. The column names can be different, but the values within the cells must be the same so we can join them.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use left_join() function to join the the illinois data -------</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># EXAMPLE 1: Join them with the same "dist_id" name </span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>example_1_il_finance_testing_fy23 <span class="ot">&lt;-</span> il_test_data_fy23_clean <span class="sc">|&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(il_finance_fy23_same_id, <span class="at">by =</span> <span class="st">"dist_id"</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># EXAMPLE 2: Join them with different column names, but they're the same values</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># dist_id comes from because it's in the il_test_data_fy23_clean dataframe </span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>example_2_il_finance_testing_fy23 <span class="ot">&lt;-</span> il_test_data_fy23_clean <span class="sc">|&gt;</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(il_finance_fy23_diff_id, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"dist_id"</span> <span class="ot">=</span> <span class="st">"rcdts"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="homework-assignment" class="level1">
<h1>Homework assignment</h1>
<section id="this-weeks-assignment" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="this-weeks-assignment">This week’s assignment</h2>
<p><strong>Reading assignment</strong></p>
<ul>
<li><a href="https://bellwether.org/wp-content/uploads/2021/10/Bellwether_SplittingBill_05-HowCanSchoolFinStudentswLearnNeeds_Final.pdf"><strong><em>How Can School Finance Systems Support Students with Additional Learning Needs?</em></strong></a></li>
</ul>
<p><strong>Coding task</strong></p>
<p>Clean your state’s district data and make sure that you have all of the data you need to model your state’s funding formula and the potential policy changes you want to make. This may require joining data frames, <code>pivot_longer()</code>, <code>pivot_wider()</code> and/or using <code>mutate()</code> to merge, reshape, and tidy data from your state.</p>
<p>Ultimately, you’ll want to produce a single data frame where:</p>
<ul>
<li>Each row represents a single LEA (traditional district or charter school)</li>
<li>Each column represents a single variable</li>
<li>All of the data elements that go into your current formula are present in the data frame.</li>
</ul>
<p>If you need to join more than two data frames, <strong>just start with joining two data frames for this assignment.</strong> We can work on building the full data set you’ll need to model your formula over the coming weeks.</p>
<p>To get started, a template R script is included: <code>scripts/dist_clean.R</code> – please use that file to load, clean, and save your tidy data.</p>
<p>As always, once you’ve completed the assignment, be sure to commit and push to GitHub!</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>